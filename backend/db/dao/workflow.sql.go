// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.29.0
// source: workflow.sql

package dao

import (
	"context"

	"github.com/jackc/pgx/v5/pgtype"
)

const archiveWorkflow = `-- name: ArchiveWorkflow :exec
UPDATE workflow
SET status = $2,
    updated_at = $3
WHERE id = $1
`

type ArchiveWorkflowParams struct {
	ID        int32  `json:"id"`
	Status    string `json:"status"`
	UpdatedAt int64  `json:"updated_at"`
}

// ArchiveWorkflow
//
//	UPDATE workflow
//	SET status = $2,
//	    updated_at = $3
//	WHERE id = $1
func (q *Queries) ArchiveWorkflow(ctx context.Context, arg *ArchiveWorkflowParams) error {
	_, err := q.db.Exec(ctx, archiveWorkflow, arg.ID, arg.Status, arg.UpdatedAt)
	return err
}

const createWorkflow = `-- name: CreateWorkflow :one
INSERT INTO workflow (
  user_id,
  name,
  description,
  status,
  created_at,
  updated_at
)
VALUES (
  $1, $2, $3, $4, $5, $6
)
RETURNING id, user_id, name, description, status, created_at, updated_at
`

type CreateWorkflowParams struct {
	UserID      string `json:"user_id"`
	Name        string `json:"name"`
	Description string `json:"description"`
	Status      string `json:"status"`
	CreatedAt   int64  `json:"created_at"`
	UpdatedAt   int64  `json:"updated_at"`
}

// CreateWorkflow
//
//	INSERT INTO workflow (
//	  user_id,
//	  name,
//	  description,
//	  status,
//	  created_at,
//	  updated_at
//	)
//	VALUES (
//	  $1, $2, $3, $4, $5, $6
//	)
//	RETURNING id, user_id, name, description, status, created_at, updated_at
func (q *Queries) CreateWorkflow(ctx context.Context, arg *CreateWorkflowParams) (*Workflow, error) {
	row := q.db.QueryRow(ctx, createWorkflow,
		arg.UserID,
		arg.Name,
		arg.Description,
		arg.Status,
		arg.CreatedAt,
		arg.UpdatedAt,
	)
	var i Workflow
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.Name,
		&i.Description,
		&i.Status,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return &i, err
}

const createWorkflowEdge = `-- name: CreateWorkflowEdge :one
INSERT INTO workflow_edge (
  workflow_id,
  source_node_id,
  target_node_id
)
VALUES (
  $1, $2, $3
)
RETURNING workflow_id, source_node_id, target_node_id
`

type CreateWorkflowEdgeParams struct {
	WorkflowID   int32 `json:"workflow_id"`
	SourceNodeID int32 `json:"source_node_id"`
	TargetNodeID int32 `json:"target_node_id"`
}

// CreateWorkflowEdge
//
//	INSERT INTO workflow_edge (
//	  workflow_id,
//	  source_node_id,
//	  target_node_id
//	)
//	VALUES (
//	  $1, $2, $3
//	)
//	RETURNING workflow_id, source_node_id, target_node_id
func (q *Queries) CreateWorkflowEdge(ctx context.Context, arg *CreateWorkflowEdgeParams) (*WorkflowEdge, error) {
	row := q.db.QueryRow(ctx, createWorkflowEdge, arg.WorkflowID, arg.SourceNodeID, arg.TargetNodeID)
	var i WorkflowEdge
	err := row.Scan(&i.WorkflowID, &i.SourceNodeID, &i.TargetNodeID)
	return &i, err
}

const createWorkflowNode = `-- name: CreateWorkflowNode :one
INSERT INTO workflow_node (
  workflow_id,
  action_type,
  config
)
VALUES (
  $1, $2, $3
)
RETURNING id, workflow_id, action_type, config
`

type CreateWorkflowNodeParams struct {
	WorkflowID int32  `json:"workflow_id"`
	ActionType string `json:"action_type"`
	Config     []byte `json:"config"`
}

// CreateWorkflowNode
//
//	INSERT INTO workflow_node (
//	  workflow_id,
//	  action_type,
//	  config
//	)
//	VALUES (
//	  $1, $2, $3
//	)
//	RETURNING id, workflow_id, action_type, config
func (q *Queries) CreateWorkflowNode(ctx context.Context, arg *CreateWorkflowNodeParams) (*WorkflowNode, error) {
	row := q.db.QueryRow(ctx, createWorkflowNode, arg.WorkflowID, arg.ActionType, arg.Config)
	var i WorkflowNode
	err := row.Scan(
		&i.ID,
		&i.WorkflowID,
		&i.ActionType,
		&i.Config,
	)
	return &i, err
}

const createWorkflowNodeUi = `-- name: CreateWorkflowNodeUi :one
INSERT INTO workflow_node_ui (
  id,
  x_position,
  y_position
)
VALUES (
  $1, $2, $3
)
RETURNING id, x_position, y_position
`

type CreateWorkflowNodeUiParams struct {
	ID        int32   `json:"id"`
	XPosition float64 `json:"x_position"`
	YPosition float64 `json:"y_position"`
}

// CreateWorkflowNodeUi
//
//	INSERT INTO workflow_node_ui (
//	  id,
//	  x_position,
//	  y_position
//	)
//	VALUES (
//	  $1, $2, $3
//	)
//	RETURNING id, x_position, y_position
func (q *Queries) CreateWorkflowNodeUi(ctx context.Context, arg *CreateWorkflowNodeUiParams) (*WorkflowNodeUi, error) {
	row := q.db.QueryRow(ctx, createWorkflowNodeUi, arg.ID, arg.XPosition, arg.YPosition)
	var i WorkflowNodeUi
	err := row.Scan(&i.ID, &i.XPosition, &i.YPosition)
	return &i, err
}

const deleteWorkflowEdge = `-- name: DeleteWorkflowEdge :exec
DELETE FROM workflow_edge
WHERE workflow_id = $1
  AND source_node_id = $2
  AND target_node_id = $3
`

type DeleteWorkflowEdgeParams struct {
	WorkflowID   int32 `json:"workflow_id"`
	SourceNodeID int32 `json:"source_node_id"`
	TargetNodeID int32 `json:"target_node_id"`
}

// DeleteWorkflowEdge
//
//	DELETE FROM workflow_edge
//	WHERE workflow_id = $1
//	  AND source_node_id = $2
//	  AND target_node_id = $3
func (q *Queries) DeleteWorkflowEdge(ctx context.Context, arg *DeleteWorkflowEdgeParams) error {
	_, err := q.db.Exec(ctx, deleteWorkflowEdge, arg.WorkflowID, arg.SourceNodeID, arg.TargetNodeID)
	return err
}

const deleteWorkflowNode = `-- name: DeleteWorkflowNode :exec
DELETE FROM workflow_node
WHERE id = $1
`

// DeleteWorkflowNode
//
//	DELETE FROM workflow_node
//	WHERE id = $1
func (q *Queries) DeleteWorkflowNode(ctx context.Context, id int32) error {
	_, err := q.db.Exec(ctx, deleteWorkflowNode, id)
	return err
}

const getChildNodeIDs = `-- name: GetChildNodeIDs :many
SELECT target_node_id
FROM workflow_edge
WHERE source_node_id = $1
`

// GetChildNodeIDs
//
//	SELECT target_node_id
//	FROM workflow_edge
//	WHERE source_node_id = $1
func (q *Queries) GetChildNodeIDs(ctx context.Context, sourceNodeID int32) ([]int32, error) {
	rows, err := q.db.Query(ctx, getChildNodeIDs, sourceNodeID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []int32
	for rows.Next() {
		var target_node_id int32
		if err := rows.Scan(&target_node_id); err != nil {
			return nil, err
		}
		items = append(items, target_node_id)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const getUserWorkflows = `-- name: GetUserWorkflows :many
SELECT id, user_id, name, description, status, created_at, updated_at
FROM workflow
WHERE user_id = $1
`

// GetUserWorkflows
//
//	SELECT id, user_id, name, description, status, created_at, updated_at
//	FROM workflow
//	WHERE user_id = $1
func (q *Queries) GetUserWorkflows(ctx context.Context, userID string) ([]*Workflow, error) {
	rows, err := q.db.Query(ctx, getUserWorkflows, userID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []*Workflow
	for rows.Next() {
		var i Workflow
		if err := rows.Scan(
			&i.ID,
			&i.UserID,
			&i.Name,
			&i.Description,
			&i.Status,
			&i.CreatedAt,
			&i.UpdatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, &i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const getWorkflow = `-- name: GetWorkflow :one
SELECT id, user_id, name, description, status, created_at, updated_at
FROM workflow
WHERE id = $1
`

// GetWorkflow
//
//	SELECT id, user_id, name, description, status, created_at, updated_at
//	FROM workflow
//	WHERE id = $1
func (q *Queries) GetWorkflow(ctx context.Context, id int32) (*Workflow, error) {
	row := q.db.QueryRow(ctx, getWorkflow, id)
	var i Workflow
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.Name,
		&i.Description,
		&i.Status,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return &i, err
}

const getWorkflowGraph = `-- name: GetWorkflowGraph :many
SELECT
  w.id AS workflow_id,
  w.name AS workflow_name,
  w.description AS workflow_description,
  w.status AS workflow_status,
  w.created_at,
  wn.id AS node_id,
  action_type,
  config,
  source_node_id,
  target_node_id
FROM workflow w
INNER JOIN workflow_node wn ON w.id = wn.workflow_id
LEFT JOIN workflow_edge we ON w.id = we.workflow_id
  AND we.source_node_id = wn.id
WHERE w.id = $1
`

type GetWorkflowGraphRow struct {
	WorkflowID          int32       `json:"workflow_id"`
	WorkflowName        string      `json:"workflow_name"`
	WorkflowDescription string      `json:"workflow_description"`
	WorkflowStatus      string      `json:"workflow_status"`
	CreatedAt           int64       `json:"created_at"`
	NodeID              int32       `json:"node_id"`
	ActionType          string      `json:"action_type"`
	Config              []byte      `json:"config"`
	SourceNodeID        pgtype.Int4 `json:"source_node_id"`
	TargetNodeID        pgtype.Int4 `json:"target_node_id"`
}

// GetWorkflowGraph
//
//	SELECT
//	  w.id AS workflow_id,
//	  w.name AS workflow_name,
//	  w.description AS workflow_description,
//	  w.status AS workflow_status,
//	  w.created_at,
//	  wn.id AS node_id,
//	  action_type,
//	  config,
//	  source_node_id,
//	  target_node_id
//	FROM workflow w
//	INNER JOIN workflow_node wn ON w.id = wn.workflow_id
//	LEFT JOIN workflow_edge we ON w.id = we.workflow_id
//	  AND we.source_node_id = wn.id
//	WHERE w.id = $1
func (q *Queries) GetWorkflowGraph(ctx context.Context, id int32) ([]*GetWorkflowGraphRow, error) {
	rows, err := q.db.Query(ctx, getWorkflowGraph, id)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []*GetWorkflowGraphRow
	for rows.Next() {
		var i GetWorkflowGraphRow
		if err := rows.Scan(
			&i.WorkflowID,
			&i.WorkflowName,
			&i.WorkflowDescription,
			&i.WorkflowStatus,
			&i.CreatedAt,
			&i.NodeID,
			&i.ActionType,
			&i.Config,
			&i.SourceNodeID,
			&i.TargetNodeID,
		); err != nil {
			return nil, err
		}
		items = append(items, &i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const renderWorkflowGraph = `-- name: RenderWorkflowGraph :many
SELECT
  w.id AS workflow_id,
  w.name AS workflow_name,
  w.description AS workflow_description,
  w.status AS workflow_status,
  w.created_at,
  wn.id AS node_id,
  wnu.x_position,
  wnu.y_position,
  action_type,
  config,
  source_node_id,
  target_node_id
FROM workflow w
INNER JOIN workflow_node wn ON w.id = wn.workflow_id
INNER JOIN workflow_node_ui wnu ON wn.id = wnu.id
LEFT JOIN workflow_edge we ON w.id = we.workflow_id
  AND we.source_node_id = wn.id
WHERE w.id = $1
`

type RenderWorkflowGraphRow struct {
	WorkflowID          int32       `json:"workflow_id"`
	WorkflowName        string      `json:"workflow_name"`
	WorkflowDescription string      `json:"workflow_description"`
	WorkflowStatus      string      `json:"workflow_status"`
	CreatedAt           int64       `json:"created_at"`
	NodeID              int32       `json:"node_id"`
	XPosition           float64     `json:"x_position"`
	YPosition           float64     `json:"y_position"`
	ActionType          string      `json:"action_type"`
	Config              []byte      `json:"config"`
	SourceNodeID        pgtype.Int4 `json:"source_node_id"`
	TargetNodeID        pgtype.Int4 `json:"target_node_id"`
}

// RenderWorkflowGraph
//
//	SELECT
//	  w.id AS workflow_id,
//	  w.name AS workflow_name,
//	  w.description AS workflow_description,
//	  w.status AS workflow_status,
//	  w.created_at,
//	  wn.id AS node_id,
//	  wnu.x_position,
//	  wnu.y_position,
//	  action_type,
//	  config,
//	  source_node_id,
//	  target_node_id
//	FROM workflow w
//	INNER JOIN workflow_node wn ON w.id = wn.workflow_id
//	INNER JOIN workflow_node_ui wnu ON wn.id = wnu.id
//	LEFT JOIN workflow_edge we ON w.id = we.workflow_id
//	  AND we.source_node_id = wn.id
//	WHERE w.id = $1
func (q *Queries) RenderWorkflowGraph(ctx context.Context, id int32) ([]*RenderWorkflowGraphRow, error) {
	rows, err := q.db.Query(ctx, renderWorkflowGraph, id)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []*RenderWorkflowGraphRow
	for rows.Next() {
		var i RenderWorkflowGraphRow
		if err := rows.Scan(
			&i.WorkflowID,
			&i.WorkflowName,
			&i.WorkflowDescription,
			&i.WorkflowStatus,
			&i.CreatedAt,
			&i.NodeID,
			&i.XPosition,
			&i.YPosition,
			&i.ActionType,
			&i.Config,
			&i.SourceNodeID,
			&i.TargetNodeID,
		); err != nil {
			return nil, err
		}
		items = append(items, &i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const updateWorkflow = `-- name: UpdateWorkflow :exec
UPDATE workflow
SET name = $2,
    description = $3,
    updated_at = $4
WHERE id = $1
`

type UpdateWorkflowParams struct {
	ID          int32  `json:"id"`
	Name        string `json:"name"`
	Description string `json:"description"`
	UpdatedAt   int64  `json:"updated_at"`
}

// UpdateWorkflow
//
//	UPDATE workflow
//	SET name = $2,
//	    description = $3,
//	    updated_at = $4
//	WHERE id = $1
func (q *Queries) UpdateWorkflow(ctx context.Context, arg *UpdateWorkflowParams) error {
	_, err := q.db.Exec(ctx, updateWorkflow,
		arg.ID,
		arg.Name,
		arg.Description,
		arg.UpdatedAt,
	)
	return err
}

const updateWorkflowNode = `-- name: UpdateWorkflowNode :exec
UPDATE workflow_node
SET action_type = $2,
    config = $3
WHERE id = $1
`

type UpdateWorkflowNodeParams struct {
	ID         int32  `json:"id"`
	ActionType string `json:"action_type"`
	Config     []byte `json:"config"`
}

// UpdateWorkflowNode
//
//	UPDATE workflow_node
//	SET action_type = $2,
//	    config = $3
//	WHERE id = $1
func (q *Queries) UpdateWorkflowNode(ctx context.Context, arg *UpdateWorkflowNodeParams) error {
	_, err := q.db.Exec(ctx, updateWorkflowNode, arg.ID, arg.ActionType, arg.Config)
	return err
}

const updateWorkflowNodeUI = `-- name: UpdateWorkflowNodeUI :exec
UPDATE workflow_node_ui
SET x_position = $2,
    y_position = $3
WHERE id = $1
`

type UpdateWorkflowNodeUIParams struct {
	ID        int32   `json:"id"`
	XPosition float64 `json:"x_position"`
	YPosition float64 `json:"y_position"`
}

// UpdateWorkflowNodeUI
//
//	UPDATE workflow_node_ui
//	SET x_position = $2,
//	    y_position = $3
//	WHERE id = $1
func (q *Queries) UpdateWorkflowNodeUI(ctx context.Context, arg *UpdateWorkflowNodeUIParams) error {
	_, err := q.db.Exec(ctx, updateWorkflowNodeUI, arg.ID, arg.XPosition, arg.YPosition)
	return err
}
